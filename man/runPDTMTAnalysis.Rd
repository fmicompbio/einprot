% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runPDTMTAnalysis.R
\name{runPDTMTAnalysis}
\alias{runPDTMTAnalysis}
\title{Run analysis on PD/TMT data}
\usage{
runPDTMTAnalysis(
  templateRmd = system.file("extdata/process_PD_TMT_template.Rmd", package = "einprot"),
  outputDir = ".",
  outputBaseName = "PDTMTAnalysis",
  reportTitle = "PD data processing",
  reportAuthor = "",
  forceOverwrite = FALSE,
  experimentInfo = list(),
  species,
  pdOutputFolder,
  pdResultName,
  inputLevel = "Proteins",
  pdAnalysisFile,
  idCol = function(df) combineIds(df, combineCols = c("Gene.Symbol", "Accession")),
  labelCol = function(df) combineIds(df, combineCols = c("Gene.Symbol", "Accession")),
  geneIdCol = function(df) getFirstId(df, colName = "Gene.Symbol"),
  proteinIdCol = "Accession",
  stringIdCol = function(df) combineIds(df, combineCols = c("Gene.Symbol", "Accession"),
    combineWhen = "missing", makeUnique = FALSE),
  modificationsCol = "Modifications",
  excludeUnmodifiedPeptides = FALSE,
  keepModifications = NULL,
  iColPattern,
  sampleAnnot,
  includeOnlySamples = "",
  excludeSamples = "",
  minScore = 2,
  minDeltaScore = 0.2,
  minPeptides = 2,
  minPSMs = 2,
  masterProteinsOnly = FALSE,
  imputeMethod = "MinProb",
  assaysForExport = NULL,
  mergeGroups = list(),
  comparisons = list(),
  ctrlGroup = "",
  allPairwiseComparisons = TRUE,
  singleFit = TRUE,
  subtractBaseline = FALSE,
  baselineGroup = "",
  normMethod = "none",
  spikeFeatures = NULL,
  stattest = "limma",
  minNbrValidValues = 2,
  minlFC = 0,
  samSignificance = FALSE,
  nperm = 250,
  volcanoAdjPvalThr = 0.05,
  volcanoLog2FCThr = 1,
  volcanoMaxFeatures = 25,
  volcanoLabelSign = "both",
  volcanoS0 = 0.1,
  volcanoFeaturesToLabel = "",
  addInteractiveVolcanos = FALSE,
  interactiveDisplayColumns = NULL,
  interactiveGroupColumn = NULL,
  complexFDRThr = 0.1,
  maxNbrComplexesToPlot = 10,
  seed = 42,
  includeFeatureCollections = c(),
  minSizeToKeepSet = 2,
  customComplexes = list(),
  complexSpecies = "all",
  complexDbPath = NULL,
  stringVersion = "11.5",
  stringDir = NULL,
  linkTableColumns = c(),
  customYml = NULL,
  doRender = TRUE
)
}
\arguments{
\item{templateRmd}{Path to the template R Markdown file. Typically does not
need to be modified.}

\item{outputDir}{Path to a directory where all output files will be
written. Will be created if it doesn't exist.}

\item{outputBaseName}{Character string providing the 'base name' of the
output files. All output files will start with this prefix.}

\item{reportTitle, reportAuthor}{Character scalars, giving the title and
author for the result report.}

\item{forceOverwrite}{Logical, whether to force overwrite an existing
Rmd file with the same \code{outputBaseName} in the \code{outputDir}.}

\item{experimentInfo}{Named list with information about the experiment.
Each entry of the list must be a scalar value.}

\item{species}{Character scalar providing the species. Must be one of the
supported species (see \code{getSupportedSpecies()}). Either the common
or the scientific name can be used.}

\item{pdOutputFolder}{Character string pointing to the PD/TMT output folder.
Should contain the files \code{pdResultName_InputFiles.txt},
\code{pdResultName_StudyInformation.txt} and
\code{pdResultName_Proteins.txt}. In order to generate the stand-alone
pdf file with QC metrics, additionally the following files should
be present:
\code{pdResultName_PSMs.txt}, \code{pdResultName_PeptideGroups.txt},
\code{pdResultName_MSMSSpectrumInfo.txt},
\code{pdResultName_QuanSpectra.txt}.}

\item{pdResultName}{Character string providing the base name for the
files in the \code{pdOutputFolder}.}

\item{inputLevel}{Character string specifying which of the PD files to use
for the analysis. Currently only \code{"Proteins"} and
\code{"PeptideGroups"} are supported.}

\item{pdAnalysisFile}{Character string pointing to the \code{pdAnalysis}
file}

\item{idCol, labelCol, geneIdCol, proteinIdCol, stringIdCol}{Arguments defining
the feature identifiers (row names, should be unique),
feature labels (for plots, can be anything),
gene IDs (single gene symbols, will be matched against complexes and
GO terms, can be \code{NULL}),
protein IDs (UniProt IDs, will be used to create automatic URLs and
match to species-specific identifiers, each entry can consist of
multiple UniProt IDs separated by semicolons), and
stringIdCol (single gene or protein ID, will be used to retrieve
STRING networks, can be \code{NULL}).
Each of these arguments can be either a character vector of column
names in the input file (after application of \code{make.names}),
in which case the corresponding feature ID
is generated by simply concatenating the values in these columns, or a
function with one input argument (a data.frame, corresponding to the
annotation columns of the input file), returning a
character vector corresponding to the desired feature IDs.}

\item{modificationsCol}{Character string pointing to a column containing
modification details. \code{excludeUnmodifiedPeptides} and
\code{keepModifications} will use information from this column. Only
used if \code{inputLevel} is "PeptideGroups".}

\item{excludeUnmodifiedPeptides}{Logical scalar, whether to filter out
peptides without modifications. Only used if \code{inputLevel} is
"PeptideGroups".}

\item{keepModifications}{Character string (or \code{NULL}) indicating
which modifications to retain in the analysis. Can be a regular
expression, which will be matched against the \code{modificationsCol}.
If \code{NULL} (the default), all rows are retained. Only used if
\code{inputLevel} is "PeptideGroups".}

\item{iColPattern}{Regular expression identifying the columns of the PD
\code{Proteins.txt} file to use for the analysis.}

\item{sampleAnnot}{A \code{data.frame} with at least columns named
\code{sample} and \code{group}, used to explicitly specify the group
assignment for each sample. It can also contain a column named
\code{batch}, in which case this will be used as a covariate in
the \code{limma} or \code{proDA} tests. The values in the \code{sample}
column should correspond to the names of the columns of interest in the
input file, after removing the \code{iColPattern}.}

\item{includeOnlySamples, excludeSamples}{Character vectors defining specific
samples to include or exclude from all analyses.}

\item{minScore, minDeltaScore}{Numeric, minimum score for a protein (or
delta score for a peptide group) to be retained in the analysis.
Set to \code{NULL} if no score filtering is desired.}

\item{minPeptides, minPSMs}{Numeric, minimum number of peptides for a protein
(or PSMs for a peptide group) to be retained in the analysis.
Set to \code{NULL} if no filtering on the number of peptides/PTMs is
desired.}

\item{masterProteinsOnly}{Logical scalar indicating whether only master
proteins (where the \code{Master} column value is
\code{IsMasterProtein}) should be retained. Only used if
\code{inputLevel} is \code{"Proteins"}.}

\item{imputeMethod}{Character string defining the imputation method to use.
Currently, \code{"impSeqRob"} and \code{"MinProb"} are supported.}

\item{assaysForExport}{Character vector defining the name(s) of the assays
to use for exported abundances and barplots. This could, for example,
be set to an assay containing 'absolute' abundances, if available, even
if another assay is used for the actual analysis and comparison of
groups. If set to \code{NULL} or an assay name that does not exist in
the SingleCellExperiment object, the 'main' assay (defined by
\code{iColPattern}) will be used.}

\item{mergeGroups}{Named list of character vectors defining sample groups
to merge to create new groups, that will be used for comparisons.
Any specification of \code{comparisons} or \code{ctrlGroup} should
be done in terms of the new (merged) group names.}

\item{comparisons}{List of character vectors defining comparisons to
perform. The first element of each vector represents the
denominator of the comparison. If not empty, \code{ctrlGroup} and
\code{allPairwiseComparisons} are ignored.}

\item{ctrlGroup}{Character vector defining the sample group(s) to use as
control group in comparisons.}

\item{allPairwiseComparisons}{Logical, should all pairwise comparisons be
performed?}

\item{singleFit}{Logical scalar indicating whether a single model fit
should be used (and results for pairwise comparisons extracted via
contrasts). If \code{FALSE}, the data set will be subset to the
relevant samples for each comparison. Only applicable if
\code{stattest} is \code{"limma"} or \code{"proDA"}.}

\item{subtractBaseline}{Logical scalar, whether to subtract the background/
reference value for each feature in each batch before fitting the
model. If \code{TRUE}, requires that a 'batch' column is available.}

\item{baselineGroup}{Character scalar representing the reference group.
Only used if \code{subtractBaseline} is \code{TRUE}, in which case the
abundance values for a given sample will be adjusted by subtracting the
average value across all samples in the \code{baselineGroup} from the
same batch as the original sample.}

\item{normMethod}{Character scalar indicating the normalization method to
use. Currently, any method from \code{MsCoreUtils::normalizeMethods()}
or \code{"none"} are valid values.}

\item{spikeFeatures}{Character vector indicating the 'spike-in' features
to use for estimation of normalization factors. If \code{NULL}
(default), all features are used.}

\item{stattest}{Either \code{"ttest"}, \code{"limma"} or \code{"proDA"},
the testing framework to use. Could also be \code{"none"} if no test
should be performed.}

\item{minNbrValidValues}{Numeric, the minimum number of valid values for a
protein to be used for statistical testing.}

\item{minlFC}{Numeric, minimum log fold change to test against (only used
if \code{stattest = "limma"}).}

\item{samSignificance}{Logical scalar, indicating whether the SAM statistic
should be used to determine significance (similar to the approach used by
Perseus). Only used if \code{stattest = "ttest"}. If \code{FALSE}, the
p-values are adjusted using the Benjamini-Hochberg approach and used
to determine significance.}

\item{nperm}{Numeric, number of permutations to use in the statistical
testing (only used if \code{stattest = "ttest"}).}

\item{volcanoAdjPvalThr}{Numeric, adjusted p-value threshold to determine
which proteins to highlight in the volcano plots.}

\item{volcanoLog2FCThr}{Numeric, log-fold change threshold to determine
which proteins to highlight in the volcano plots.}

\item{volcanoMaxFeatures}{Numeric, maximum number of significant features
to label in the volcano plots.}

\item{volcanoLabelSign}{Character scalar, either 'both', 'pos', or 'neg',
indicating whether to label the most significant features regardless of
sign, or only those with positive/negative log-fold changes.}

\item{volcanoS0}{Numeric, S0 value to use to generate the significance
curve in the volcano plots (only used if \code{stattest = "ttest"}).}

\item{volcanoFeaturesToLabel}{Character vector with features to always
label in the volcano plots (regardless of significance).}

\item{addInteractiveVolcanos}{Logical scalar indicating whether to add
interactive volcano plots to the html report. For experiments with
many quantified features or many comparisons, setting this to
\code{TRUE} can make the html report very large and difficult to
interact with.}

\item{interactiveDisplayColumns}{Character vector (or \code{NULL})
indicating which columns to include in the tooltip for the
interactive volcano plots. The default shows the feature ID.}

\item{interactiveGroupColumn}{Character scalar (or \code{NULL}, default)
indicating the column to group points by in the interactive volcano
plot. Hovering over a point will highlight all other points with the
same value of this column.}

\item{complexFDRThr}{Numeric, FDR threshold for significance in testing
of complexes.}

\item{maxNbrComplexesToPlot}{Numeric, the maximum number of significant
complexes for which to make separate volcano plots.}

\item{seed}{Numeric, random seed to use for any non-deterministic
calculations.}

\item{includeFeatureCollections}{Character vector, a subset of
\code{c("complexes", "GO")}.}

\item{minSizeToKeepSet}{Numeric scalar indicating the smallest number of
features that have to overlap with the current data set in order to
retain a feature set for testing.}

\item{customComplexes}{List of character vectors providing custom complexes
to test for significant differences between groups.}

\item{complexSpecies}{Either \code{"all"} or \code{"current"}, depending
on whether complexes defined for all species, or only those defined
for the current species, should be tested for significance.}

\item{complexDbPath}{Character string providing path to the complex DB
file (generated with \code{makeComplexDB()}).}

\item{stringVersion}{Character scalar giving the version of the STRING
database to query.}

\item{stringDir}{Character scalar (or \code{NULL}) providing the path to a
folder where the STRING files will be downloaded (or loaded from, if
they already exist). If \code{NULL} (default), they will be downloaded
to a temporary directory.}

\item{linkTableColumns}{Character vector with regular expressions that will
be matched against the column names of the rowData of the generated
SingleCellExperiment object and included in the link table in the end
of the report.}

\item{customYml}{Character string providing the path to a custom YAML file
that can be used to overwrite default settings in the report. If set
to \code{NULL} (default), no alterations are made.}

\item{doRender}{Logical scalar. If \code{FALSE}, the Rmd file will be
generated (and any parameters injected), but not rendered.}
}
\value{
Invisibly, the path to the compiled html report.
}
\description{
Launch a workflow on quantifications obtained with
\code{Proteome Discoverer}.
}
\examples{
if (interactive()) {
    ## Basic analysis
    out <- runPDTMTAnalysis(
        outputDir = tempdir(),
        outputBaseName = "PD_TMT_basic",
        species = "baker's yeast",
        iColPattern = "^Abundance.F.+.Sample.",
        pdOutputFolder = system.file("extdata", "pdtmt_example",
                                     package = "einprot"),
        pdResultName = "Fig2_m23139_RTS_QC_varMods",
        inputLevel = "Proteins",
        pdAnalysisFile = system.file("extdata", "pdtmt_example",
                          "Fig2_m23139_RTS_QC_varMods.pdAnalysis",
                          package = "einprot"),
        sampleAnnot = data.frame(
            sample = c("HIS4KO_S05", "HIS4KO_S06", "HIS4KO_S07", "HIS4KO_S08",
                       "MET6KO_S01", "MET6KO_S02", "MET6KO_S03", "MET6KO_S04",
                       "URA2KO_S09", "URA2KO_S10", "URA2KO_S11", "URA2KO_S12",
                       "WT_S13", "WT_S14", "WT_S15", "WT_S16"),
            group = c(rep("HIS4KO", 4), rep("MET6KO", 4), rep("URA2KO", 4),
                      rep("WT", 4))),
        stringIdCol = NULL
    )
    ## Output file
    out
}

}
\author{
Charlotte Soneson
}
